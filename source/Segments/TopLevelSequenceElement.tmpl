@*
TopLevelSequenceElement.tmpl

Created by Graham Dennis on 2007-08-27.
Copyright (c) 2007 __MyCompanyName__. All rights reserved.
*@
@extends _Segment

@assert $segmentNumber == 0
@attr $globalNameSpaceName = "topLevelSequence"

@*
  Description of template
*@
@def description: segment $segmentNumber (Top level sequence)

@*
  Function prototypes
*@
@def functionPrototypes
  @#
  @super
  @#
void _segment0();
@end def

@def topLevelSequenceInnerContent
  @#
$propagationDimension = 0.0;
  @#
  @for $field in $filter(lambda x: not x.isOutputField, $fields)
    @set $result = $field.initialise
    @if $result

${result}@slurp
    @end if
  @end for
  @#
  @for $momentGroup in $momentGroups
    @# We only need to set the sample index for the propagation dimension
    @# and only if this moment group has the propagation dimension as one
    @# of its dimensions
    @if not $momentGroup.hasDimensionName($propagationDimension)
      @continue
    @end if
_mg${momentGroup.number}_sample_index_${propagationDimension} = 0;
  @end for
  @#
  @for $momentGroup in $filter(lambda x: x.requiresInitialSample, $momentGroups)
_mg${momentGroup.number}_sample();
  @end for
  @#
  @for $segment in $childSegments
_segment${segment.segmentNumber}();
  @end for
  @#

  @for $momentGroup in $momentGroups
_mg${momentGroup.number}_process();
  @end for  
  @#
@end def
