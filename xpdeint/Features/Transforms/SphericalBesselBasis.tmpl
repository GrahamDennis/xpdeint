@*
SphericalBesselBasis.tmpl

Created by Graham Dennis on 2008-12-21.
Copyright (c) 2008 __MyCompanyName__. All rights reserved.
*@
@extends xpdeint.Features.Transforms.BesselBasis

@def description: Spherical Bessel function basis

@from xpdeint.CallOnceGuards import callOnceGuard

@def cflags
-lgsl@slurp
@end def

@@callOnceGuard
@def includes
#include <gsl/gsl_sf_bessel.h>
@end def

@def globalsForDim($dim)
  @#
const double _normbesseljzeros_${dim.name}[] = {${wrapArray($normalisedBesselJZeros($order + 0.5, dim.inSpace(0).lattice))}};
const double _besseljnorm_${dim.name} = ${besselJZeros($order + 0.5, dim.inSpace(0).lattice+1)[-1]};
  @#
  @super(dim)
  @#
@end def

@def besselJFunctionCall($order, $argument)
  @if $order in [0, 1, 2]
gsl_sf_bessel_j${order}($argument)@slurp
  @else
gsl_sf_bessel_jl($order, $argument)@slurp
  @end if
@end def

@def stepWeightForDimRepAtIndex($dimRep, $index)
  @#
sqrt(M_PI/2.0) * 2.0 / (besselFactor * besselFactor * _besseljnorm_${dimRep.parent.name} * _besseljnorm_${dimRep.parent.name} * _besseljnorm_${dimRep.parent.name}) * ${dimRep.name}_max * ${dimRep.name}_max * ${dimRep.name}_max@slurp
  @#
@end def
